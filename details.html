<!DOCTYPE html>
<html>
<head>
  <title>Medicine Details</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: sans-serif; margin: 20px; }
    label, input, button { display: block; margin: 10px 0; width: 100%; max-width: 400px; }
    span { font-weight: bold; }
    @media (max-width: 600px) {
      label, input, button { font-size: 14px; }
    }
  </style>
</head>
<body>

  <h2>Medicine Details</h2>

  <div id="displayArea">
    <p><span>Name:</span> <span id="name"></span></p>
    <p><span>Initial Stock:</span> <span id="initial"></span></p>
    <p><span>Units Sold:</span> <span id="sold"></span></p>
    <p><span>Remaining Stock:</span> <span id="remaining"></span></p>
    <p><span>Reorder Level:</span> <span id="reorder"></span></p>
    <p><span>Status:</span> <span id="status"></span></p>
    <p><span>Last Bought Date:</span> <span id="lastBought"></span></p>
  </div>

  <h3>Edit Stock</h3>
  <label>Stock Used: <input type="number" id="stockUsed"></label>
  <label>Stock Bought: <input type="number" id="stockBought"></label>
  <label>Date of Buying: <input type="date" id="dateBought"></label>
  <button onclick="updateStock()">Update</button>
  <button onclick="goBack()">‚Üê Back to Summary</button>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const medicineName = urlParams.get("name");

    const nameEl = document.getElementById("name");
    const initialEl = document.getElementById("initial");
    const soldEl = document.getElementById("sold");
    const remainingEl = document.getElementById("remaining");
    const reorderEl = document.getElementById("reorder");
    const statusEl = document.getElementById("status");
    const lastBoughtEl = document.getElementById("lastBought");

    let medicines = JSON.parse(localStorage.getItem("medicines")) || [];
    let medicine = medicines.find(m => m.name === medicineName);

    function loadData() {
      if (!medicine) {
        alert("Medicine not found.");
        return;
      }

      const remaining = medicine.initial - medicine.sold;
      const status = remaining <= medicine.reorder ? "LOW STOCK" : "OK";

      nameEl.textContent = medicine.name;
      initialEl.textContent = medicine.initial;
      soldEl.textContent = medicine.sold;
      remainingEl.textContent = remaining;
      reorderEl.textContent = medicine.reorder;
      statusEl.textContent = status;
      lastBoughtEl.textContent = medicine.lastBought || "-";
    }

    function updateStock() {
      const used = parseInt(document.getElementById("stockUsed").value) || 0;
      const bought = parseInt(document.getElementById("stockBought").value) || 0;
      const date = document.getElementById("dateBought").value;

      medicine.initial += bought;
      medicine.sold += used;
      if (bought > 0 && date) medicine.lastBought = date;

      localStorage.setItem("medicines", JSON.stringify(medicines));
      loadData();

      document.getElementById("stockUsed").value = "";
      document.getElementById("stockBought").value = "";
      document.getElementById("dateBought").value = "";
    }

    function goBack() {
      window.location.href = "index.html";
    }

    loadData();
  </script>

</body>
</html>