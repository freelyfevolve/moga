<!DOCTYPE html>
<html>
<head>
  <title>Medicine Details</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: sans-serif; margin: 20px; max-width: 600px; }
    label { display: block; margin: 10px 0 5px; }
    input, button, select { width: 100%; padding: 8px; margin-bottom: 10px; }
    button { max-width: 200px; }
  </style>
</head>
<body>

  <h2 id="pageTitle">Medicine Details</h2>

  <label>Medicine Name:
    <input type="text" id="name" disabled>
  </label>
  <label>Initial Stock:
    <input type="number" id="initial" disabled>
  </label>
  <label>Units Sold:
    <input type="number" id="sold" disabled>
  </label>
  <label>Remaining Stock:
    <input type="number" id="remaining" disabled>
  </label>
  <label>Reorder Level:
    <input type="number" id="reorder" disabled>
  </label>
  <label>Status:
    <input type="text" id="status" disabled>
  </label>
  <label>Last Bought Date:
    <input type="date" id="lastBought" disabled>
  </label>

  <hr>

  <label>Stock Used (subtract from Initial Stock):
    <input type="number" id="stockUsed" min="0" value="0">
  </label>
  <label>Stock Bought (add to Initial Stock):
    <input type="number" id="stockBought" min="0" value="0">
  </label>
  <label>Date of Buying:
    <input type="date" id="dateOfBuying" value="">
  </label>

  <button id="saveBtn">Save Changes</button>
  <button onclick="goBack()">Back to Summary</button>

  <script>
    const API_URL = 'https://script.google.com/macros/s/AKfycbyA41BWjuryz8_fpwEU_hoX31A6ma0En2MsZeygfnF51ALwAg6yuoGQEHZerJnGapl6zA/exec';

    const urlParams = new URLSearchParams(window.location.search);
    const medName = decodeURIComponent(urlParams.get('name') || '');
    const mode = urlParams.get('mode') || 'view';

    const elements = {
      name: document.getElementById('name'),
      initial: document.getElementById('initial'),
      sold: document.getElementById('sold'),
      remaining: document.getElementById('remaining'),
      reorder: document.getElementById('reorder'),
      status: document.getElementById('status'),
      lastBought: document.getElementById('lastBought'),
      stockUsed: document.getElementById('stockUsed'),
      stockBought: document.getElementById('stockBought'),
      dateOfBuying: document.getElementById('dateOfBuying'),
      saveBtn: document.getElementById('saveBtn'),
      pageTitle: document.getElementById('pageTitle'),
    };

    elements.saveBtn.style.display = mode === 'edit' ? 'inline-block' : 'none';

    async function loadMedicine() {
      try {
        const res = await fetch(API_URL + '?action=get');
        const meds = await res.json();
        const med = meds.find(m => m.name.toLowerCase() === medName.toLowerCase());
        if (!med) {
          alert('Medicine not found');
          goBack();
          return;
        }

        elements.name.value = med.name;
       
